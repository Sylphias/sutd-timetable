<!DOCTYPE html>
<html>
 <head>
  <meta charset='utf-8' />
  <link rel='stylesheet' type='text/css' href='//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.6.0/fullcalendar.min.css' />
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js'></script>
  <script type='text/javascript' src='//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.6.0/fullcalendar.min.js'></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script type='text/javascript'>
  $(document).ready(function(){
 	$('#calendar').fullCalendar({
		header: { left: 'prev,next today', center: 'title', right:'month,agendaWeek' },
		businessHours: { start: '08:00', end: '20:00' },
		weekends: false, minTime: "06:00:00", maxTime: "22:00:00",
		editable: false,
		defaultView: 'agendaWeek',
		events: [
			{ title: 'test', start: '2016-01-15T09:00:00', end: '2016-01-15T11:00:00' },
		]
	});
  });
  </script>
  <script type='text/javascript' >
  $(document).ready(function(){
   $("#uploader").dialog({autoOpen:false,width:800});
   $("#uopen").click(function(){$("#uploader").dialog("open");});
   $("#uform").submit(function(e){
    e.preventDefault();
    var fd = new FormData($(this)[0]);
  	$.ajax({
		url: "/upload", type: "POST", data: fd,
		processData: false, contentType: false,
		success: function(r){
			if ( r.success ){
				var succ = $("<p/>").text( r.message );
				var lic = $("<p/>").text( "Processed entries:" );
				var mlist = $("<ul/>");
			    $.each( r.processed, function(i){
					var sub = r.processed[i];
					var li = $("<li/>").text(sub[0]+' (Section: '+sub[1]+')').appendTo(mlist);
				});
				mlist.appendTo(lic); lic.appendTo(succ); $("#uploader").html(succ);
			} else { $("#uploadstatus").html( r.message ); }
		}
	})
   })
  });
  </script>
  <style type='text/css'>
  #calendar { width: 800px; margin: 0 auto; display: none; }
  </style>
 </head>
 <body>
  <input id="uopen" type="button" value="Upload Timetable" />
  <div id='calendar'></div>
  <div id='uploader' title="Upload">
   <form id="uform" method="post" enctype="multipart/form-data">
   <ol>
    <li>Login to <a target="_blank" href="https://sams.sutd.edu.sg/">https://sams.sutd.edu.sg/</a> with your school login.</li>
    <li>Paste this url into the location bar:<pre>https://sams.sutd.edu.sg/psc/CSPRD/EMPLOYEE/HRMS/c/SA_LEARNER_SERVICES.SSR_SSENRL_LIST.GBL</pre></li>
    <li>Save the page ( e.g. *Right click* &rarr; Save page as ).</li>
    <li>Upload the .html here: <input type="file" name="timetable"><input type="submit" value="Upload" /></li>
   </ol>
   </form>
   <p id='uploadstatus'></p>
  </div>
 </body>
</html>
